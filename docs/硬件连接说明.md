### **准备工作：定义“集线器”**

1.  **系统GND集线器 (The GND Hub):**
    *   这就是在 **TP4056保护板** 的 **`OUT-`** 端子上引出的那个杜邦接口。
    *   **规则：** 之后说明中所有提到的 **“连接到 系统GND”**，都意味着连接到这个GND集线器。

2.  **系统VCC总线 (The VCC Rail):**
    *   为了方便，同样定义一个概念：**TP4056保护板** 的 **`OUT+`** 端子就是 **“系统VCC总线”**。
    *   **规则：** 这是所有需要直接从电池取电的模块的电源起点。

3.  **3.3V电源轨 (The 3.3V Rail):**
    *   **XC6206 LDO** 的 **`Vout`** 输出引脚就是 **“3.3V电源轨”**。
    *   **规则：** 所有需要3.3V稳定电压的模块都从这里取电。

---

### **连接说明 (Step-by-Step Checklist)**

#### **Part 1: 核心能源系统组装**

*   **[1.1] 电池 -> 保护板:**
    *   `18650电池组 正极` → `TP4056 B+`
    *   `18650电池组 负极` → `TP4056 B-`
    *   *(Note: 这是电池唯一的连接点，确保其安全)*

*   **[1.2] 太阳能 -> 充电模块:**
    *   `太阳能板 正极` → `CN3795 INPUT +`
    *   `太阳能板 负极` → `CN3795 INPUT -`

*   **[1.3] 充电模块 -> 保护板:**
    *   `CN3795 OUTPUT +` (或 `VBAT`) → `TP4056 OUT+` (即 **系统VCC总线**)
    *   `CN3795 OUTPUT -` (或 `GND`) → `TP4056 OUT-` (即 **系统GND集线器**)

#### **Part 2: 3.3V稳压与主控供电**

*   **[2.1] LDO供电:**
    *   **系统VCC总线** (`TP4056 OUT+`) → `XC6206 LDO Vin`
    *   **系统GND集线器** → `XC6206 LDO GND`

*   **[2.2] ESP32主控供电:**
    *   `XC6206 LDO Vout` (即 **3.3V电源轨**) → `ESP32-S3 3V3` (任意一个3V3引脚)
    *   **系统GND集线器** → `ESP32-S3 GND` (任意一个GND引脚)

#### **Part 3: 电源门控 (P-MOSFET) 组装**

*   **[3.1] 12V动力系统开关 (MOSFET #1):**
    *   `MOSFET #1 源极(S)` → **系统VCC总线** (`TP4056 OUT+`)
    *   `MOSFET #1 栅极(G)` → `ESP32-S3 GPIO9`
    *   `~2kΩ电阻 腿1` → `MOSFET #1 源极(S)`
    *   `~2kΩ电阻 腿2` → `MOSFET #1 栅极(G)`
    *   *(Note: MOSFET #1的漏极(D)将作为12V升压模块的电源输入)*

*   **[3.2] 传感器开关 (MOSFET #2):**
    *   `MOSFET #2 源极(S)` → **3.3V电源轨** (`LDO Vout`)
    *   `MOSFET #2 栅极(G)` → `ESP32-S3 GPIO10`
    *   `~2kΩ电阻 腿1` → `MOSFET #2 源极(S)`
    *   `~2kΩ电阻 腿2` → `MOSFET #2 栅极(G)`
    *   *(Note: MOSFET #2的漏极(D)将作为传感器的VCC)*

*   **[3.3] 墨水屏开关 (MOSFET #3):**
    *   `MOSFET #3 源极(S)` → **3.3V电源轨** (`LDO Vout`)
    *   `MOSFET #3 栅极(G)` → `ESP32-S3 GPIO11`
    *   `~2kΩ电阻 腿1` → `MOSFET #3 源极(S)`
    *   `~2kΩ电阻 腿2` → `MOSFET #3 栅极(G)`
    *   *(Note: MOSFET #3的漏极(D)将作为墨水屏的VCC)*

#### **Part 4: 12V高功率系统连接**

*   **[4.1] 升压模块供电:**
    *   `MOSFET #1 漏极(D)` → `12V升压模块 IN+`
    *   **系统GND集线器** → `12V升压模块 IN-`

*   **[4.2] 缓冲电容安装:**
    *   `100µF电容 正极` → `12V升压模块 IN+`
    *   `100µF电容 负极` → `12V升压模块 IN-`

*   **[4.3] 驱动模块动力连接:**
    *   `12V升压模块 OUT+` → `4通道驱动板 DC+`
    *   `12V升压模块 OUT-` → `4通道驱动板 DC-`

*   **[4.4] 驱动模块信号连接 (带电平转换):**
    *   **水泵控制电路 (使用GPIO12):**
        *   `ESP32-S3 GPIO12` → `1kΩ电阻 腿1`
        *   `1kΩ电阻 腿2` → `S8050 NPN三极管 基极(B)`
        *   `S8050 NPN三极管 发射极(E)` → **系统GND集线器**
        *   `12V升压模块 OUT+` → `10kΩ电阻 腿1`
        *   将 `S8050 NPN三极管 集电极(C)` 与 `10kΩ电阻 腿2` **连接在一起**。
        *   从上述连接点引出一条线 → `4通道驱动板 PWM1`
        *   **系统GND集线器** → `4通道驱动板 GND1`
    *   **电磁阀控制电路 (使用GPIO13):**
        *   (电路同上, 将 `GPIO12` 替换为 `GPIO13`, `PWM1`/`GND1` 替换为 `PWM2`/`GND2`)

*   **[4.5] 执行器连接:**
    *   `水泵 正极` → `4通道驱动板 OUT1+`
    *   `水泵 负极` → `4通道驱动板 OUT1-`
    *   `电磁阀 正极` → `4通道驱动板 OUT2+`
    *   `电磁阀 负极` → `4通道驱动板 OUT2-`

#### **Part 5: 3.3V外设连接**

*   **[5.1] 土壤湿度传感器:**
    *   `MOSFET #2 漏极(D)` → `土壤传感器 VCC`
    *   **系统GND集线器** → `土壤传感器 GND`
    *   `ESP32-S3 GPIO4` → `土壤传感器 DATA/SIG`

*   **[5.2] 电子墨水屏:**
    *   `MOSFET #3 漏极(D)` → `墨水屏 VCC`
    *   **系统GND集线器** → `墨水屏 GND`
    *   `ESP32-S3 GPIO41` → `墨水屏 DIN`
    *   `ESP32-S3 GPIO40` → `墨水屏 CLK`
    *   `ESP32-S3 GPIO42` → `墨水屏 CS`
    *   `ESP32-S3 GPIO38` → `墨水屏 DC`
    *   `ESP32-S3 GPIO14` → `墨水屏 RST`
    *   `ESP32-S3 GPIO15` → `墨水屏 BUSY`

#### **Part 6: 用户输入设备连接**

*   **[6.1] 旋转编码器:**
    *   `编码器 引脚 A (CLK)` → `ESP32-S3 GPIO1`
    *   `编码器 引脚 B (DT)` → `ESP32-S3 GPIO2`
    *   `编码器 引脚 C (中间)` → **系统GND集线器**
    *   `编码器 开关引脚 S1` → `ESP32-S3 GPIO21`
    *   `编码器 开关引脚 S2` → **系统GND集线器**

*   **[6.2] 模式选择开关:**
    *   `开关 输入1` → `ESP32-S3 GPIO5`
    *   `开关 输入2` → `ESP32-S3 GPIO6`
    *   `开关 公共端` → **系统GND集线器**

#### **Part 7: 系统状态监测**

*   **[7.1] 电池电压检测电路:**
    *   `大电阻 (1.1MΩ) 腿1` → **系统VCC总线** (`TP4056 OUT+`)
    *   `小电阻 (230kΩ) 腿1` → **系统GND集线器** (`TP4056 OUT-`)
    *   将 `大电阻 腿2` 和 `小电阻 腿2` **拧在一起**，形成 **“电压测量点”**。
    *   **电压测量点** → `ESP32-S3 GPIO7`
    *   `0.1µF (104) 陶瓷电容 腿1` → **电压测量点**
    *   `0.1µF (104) 陶瓷电容 腿2` → **系统GND集线器**

---

### **最终检查**

完成以上所有连接后，请做最后检查：
*   **GND集线器:** 确认所有需要接地的设备（ESP32, LDO, 升压模块, 驱动板, 传感器, 墨水屏, 编码器, 开关）的GND引脚，最终都汇集到了GND集线器上。
*   **电源隔离:** 确认只有LDO和ESP32连接到了3.3V电源轨，其他外设的VCC都经过了各自的MOSFET开关。
*   **极性:** 再次检查电解电容和电池的极性是否正确。