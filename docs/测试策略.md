# HydroSense 测试策略

## 概述

采用轻量级硬件在环（HIL）测试策略，通过 `#ifdef TEST_MODE` 宏隔离测试代码，使用串口CLI进行验证。

## 核心架构

```
src/test/
├── test_cli.h/cpp               # CLI输入处理
├── test_command_registry.h/cpp  # 命令注册
├── test_commands_core.h/cpp     # 核心命令 (echo, help)
├── test_commands_hal.h/cpp      # HAL命令 (电源控制等)
└── test_mode.h/cpp              # 测试模式管理
```

## 已实现命令

```bash
help                    # 显示帮助
echo <text>            # 测试通信
power <module> <on|off> # 电源控制
  - sensor   # 传感器电源
  - boost12v # 12V升压模块
  - screen  # 墨水屏电源
```

## 测试流程

使用 `run_test.py` 脚本：

```bash
# 编译上传
pio run -e test --target upload

# 被动观测（查看启动日志）
python run_test.py --timeout 5

# 主动测试（发送命令）
python run_test.py --command "help"
python run_test.py --command "power sensor on"
```

## 优势

- 低成本、高效率
- 真实硬件验证
- 测试代码完全隔离
- AI友好的文本接口