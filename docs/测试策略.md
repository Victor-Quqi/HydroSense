# HydroSense 测试策略

## 概述

采用轻量级硬件在环（HIL）测试策略，通过测试模式和串口CLI实现高效验证。

## 核心架构

**编译时隔离**
- `#ifdef TEST_MODE` 宏完全隔离测试代码
- 生产版本零性能影响
- PlatformIO构建配置控制

**测试模块**
```
src/test/
├── test_mode.h/cpp    # 测试模式管理
└── test_cli.h/cpp     # 串口CLI接口
```

## CLI命令集 (设计原则)

CLI命令集的设计应遵循简洁、直观的原则，并覆盖以下几类核心功能，具体的命令格式在开发HAL层时定义。

*   **状态查询**: 提供获取系统当前完整状态（如传感器读数、电源状态、模式等）的命令。
*   **硬件控制**: 提供对每一个独立硬件模块（如电源门、执行器、显示屏）进行开关、读写和控制的能力。
*   **输入模拟**: 提供模拟各种外部输入（如传感器数值、按键事件）的命令，用于在不受物理条件限制的情况下测试上层逻辑。
*   **逻辑触发**: 提供手动触发关键业务逻辑（如ULP决策、主CPU的浇水流程）的命令，用于分步调试。

## 自动化测试流程

1. **场景设置** - 使用mock命令创建虚拟环境
2. **逻辑触发** - 使用trigger命令启动决策
3. **状态验证** - 使用status命令监控变化
4. **结果分析** - 验证行为符合预期

## 配置参数

```cpp
#define TEST_CLI_BAUD_RATE 115200   // 串口波特率
//待补充
```

## 构建测试

```bash
pio run --target upload --build-flag "-D TEST_MODE"
pio device monitor
```

## 优势

- 低成本、高效率
- 真实硬件验证
- AI友好的文本接口
- 测试代码完全隔离