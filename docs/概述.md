### **项目：HydroSense - 能量自持型智能浇水系统**

#### **元器件清单 (BOM - Bill of Materials)**

**一、 核心控制 (Core Control)**

| 序号 | 元器件名称/型号 | 核心作用与设计角色 |
| :--- | :--- | :--- |
| 1 | ESP32-S3 开发板 / 投入生产时使用 ESP32-S3-WROOM-1 模组 | **项目大脑 (The Brain):** 系统的中央处理器。选用ESP32-S3是因其独特的“双核”特性：一个强大的主核心处理复杂任务，一个超低功耗协处理器（ULP）在主核心沉睡时以纳瓦级功耗执行周期性监测。这一“哨兵-指挥官”架构是实现微安级待机的软件基石。 |

**二、 电源与能源系统 (Power & Energy System)**

| 序号 | 元器件名称/型号 | 核心作用与设计角色 |
| :--- | :--- | :--- |
| 2 | 18650 锂电池 (x2, 并联) | **储能单元 (Energy Storage):** 系统能量的蓄水池。采用两节高品质18650电池并联，旨在获得一个大容量（5000mAh）的能源储备，以轻松应对连续数日的阴雨天气。 |
| 3 | TP4056 Type-C 锂电池充电保护板 | **中央电源安全枢纽 (Central Power & Safety Hub):** 系统的“心脏瓣膜”与“总保险”。它扮演双重角色：1) 作为USB充电接口；2) 更重要的是，其集成的保护IC是电池唯一的安全守门员，为电池提供过充、过放、过流保护。系统中**所有**的充电输入（USB/太阳能）和用电输出都必须经过此模块的`OUT+/-`端子，确保绝对安全。 |
| 4 | CN3795 MPPT 太阳能充电模块 (可调电压版) | **能量采集器 (Energy Harvester):** 作为一个热插拔扩展模块，它负责从太阳能板高效采集能量。其MPPT（最大功率点跟踪）功能可实时榨取太阳能板每一分输出潜力，极大提升了在非理想光照下的充电效率。 |
| 5 | 9V 5W 多晶硅太阳能板 (玻璃层压/铝边框) | **外界能源接口 (External Energy Interface):** 系统的主要能量来源，为实现“永久续航”提供动力。选用玻璃层压和铝边框结构是为了确保其在户外风吹日晒雨淋环境下的长期耐用性和可靠性。 |
| 6 | XC6206 (3.3V LDO) | **精密电源轨 (Precision Power Rail):** 系统的“精炼营养液”。它将电池不稳定的电压转换为极其稳定纯净的3.3V，专门供给对电压敏感的MCU、传感器和显示屏。其自身微安级的静态电流是低功耗硬件设计的关键支点。 |
| 7 | 12V 固定输出升压模块 | **执行器动力源 (Actuator's Power Source):** 系统的“肌肉兴奋剂”。它将电池的低电压升至12V，为需要强劲动力的水泵和电磁阀提供专属能源。 |
| 8 | 25V 100µF 电解电容 | **冲击电流缓冲器 (Inrush Current Buffer):** 动力系统的“稳压器”。在12V升压模块的输入端并联，为其启动的瞬间提供充足的瞬时电流，有效防止电池电压的骤降导致主控复位，保障系统高负载下稳定运行。 |
| 9 | P沟道MOSFET (AO3401A x3) | **智能电源门卫 (Smart Power Gates):** 实现“零待机功耗”的核心执行者。它们像由MCU控制的微型物理开关，在不使用时彻底切断各个功能模块的电源，从根源上杜绝电力泄漏。 |
| 10 | **~2kΩ 直插电阻** | **启动状态稳定器 (Startup State Stabilizer):** 这是确保系统**上电安全**的关键元件。ESP32-S3的GPIO在上电未初始化时，会呈现一个约1.05V的弱低电平状态。此强上拉电阻，其“拉力”足以**战胜**这个默认状态，强制将P-MOSFET的栅极电压拉高至电源电压，确保MOSFET在MCU启动的“空窗期”内**绝对关闭**，防止外设意外启动。 |

**三、 传感与输入 (Sensing & Input)**

| 序号 | 元器件名称/型号 | 核心作用与设计角色 |
| :--- | :--- | :--- |
| 11 | 电容式土壤湿度传感器 (内置稳压芯片) | **感知触手 (Sense Organ):** 精准测量土壤湿度。选用电容式而非电阻式是为了避免电极腐蚀，延长使用寿命。其电源由独立的MOSFET从**3.3V稳定电源轨**控制，确保了读数精度。 |
| 12 | EC11 旋转编码器 (带按键功能) | **数字化调节旋钮 (Digital Tuning Knob):** 提供比传统电位器更精确、无磨损的数字调节方式。其机械开关特性使其静止时零功耗，同时其按键和旋转动作均可作为GPIO中断源，从深度睡眠中唤醒主控。 |
| 13 | 双刀三掷 (DP3T) 开关 | **模式选择器 (Mode Selector):** 提供明确、可靠的物理模式切换。选择机械开关而非触摸或软开关，同样是为了在任何状态下都实现零功耗。 |

**四、 显示与执行 (Display & Actuation)**

| 序号 | 元器件名称/型号 | 核心作用与设计角色 |
| :--- | :--- | :--- |
| 14 | Waveshare 1.54英寸 电子墨水屏模块 (Rev2.1) | **零功耗状态面板 (Zero-Power Status Panel):** 系统的“脸面”。其“双稳态”特性（画面刷新后不耗电）完美契合了项目的低功耗设计哲学，解决了传统显示屏与深度睡眠的根本矛盾。 |
| 15 | 4通道MOSFET驱动模块 (SKU:01357) | **执行中枢 (Actuation Hub):** 系统的“神经-肌肉连接处”。它使用ESP32的3.3V逻辑信号，去安全、高效地开关12V的大电流负载。其设计确保了高压执行电路与低压控制电路之间绝对的电气安全。 |
| 16 | 12V 370自吸水泵 | **执行机构-水泵 (Actuator - Pump):** 系统的“心脏”，负责输送水源。 |
| 17 | 12V 常闭电磁阀 | **执行机构-安全阀 (Actuator - Safety Valve):** 系统的“主动脉瓣”，作为100%防止滴漏的双重保险，确保在系统断电或水泵停止后，水路被物理切断。 |

**五、 原型、连接与机械组件 (Prototyping, Connectivity & Mechanical Parts)**

| 序号 | 元器件名称/型号 | 核心作用与设计角色 |
| :--- | :--- | :--- |
| 18 | SOT-23/SOP 转 DIP 转接板 | **贴片元件适配器 (SMD Adapter):** 搭建在“原型”与“成品”之间的桥梁。它将XC6206、AO3401A等高性能但难以手焊的贴片元件，转换为可在面包板或洞洞板上轻松使用的标准插针。 |
| 19 | 面包板 & 杜邦线 | **原型试验田 (Prototyping Ground):** 用于在“虚拟”设计和“物理”实现之间进行快速、无损的电路搭建与验证。 |
| 20 | 洞洞板/万用板 & 导线 | **原型固化板 (Prototype Solidification):** 用于将验证成功的电路进行焊接，形成一个比面包板更稳固、可靠的半永久性原型。 |
| 21 | XH2.54/JST 连接器套件 | **模块化接口 (Modular Interfaces):** 系统的“关节”。为传感器、显示屏、电池等各个模块配备标准化的连接器，使得最终产品的组装、调试和维修变得极其简单方便。 |
| 22 | **硅胶软管** | **流体血管 (Water Veins):** 连接水源、水泵、电磁阀和植物的管道。选用柔韧耐用的硅胶材质，便于布线。 |
| 23 | **3D打印/项目通用外壳** | **骨骼与皮肤 (Skeleton & Skin):** 为内部精密的电子元件提供物理保护、固定安装位置，并赋予产品一个完整、美观的外形。 |
| 24 | **螺丝、螺母、铜柱** | **连接组织 (Connective Tissue):** 用于将PCB主板、各个模块、电池座等牢固地安装在外壳内部。 |
| 25 | **电缆防水接头、密封胶** | **防水屏障 (Waterproofing Barrier):** 在传感器线、太阳能板线穿出外壳的位置使用，防止雨水侵入，是确保户外长期稳定运行的关键措施。 |

---

### **项目技术与运行逻辑概述**

#### **项目愿景与设计哲学**

HydroSense 旨在成为一个能够实现**能量自持 (Energy Self-Sufficient)**、达成“永久续航”级别的智能植物养护终端。其设计哲学融合了**极致的低功耗**与**高效的能量采集**，通过“哨兵-指挥官”协同架构将系统待机功耗降至微安级，同时利用模块化的太阳能系统在后台静默地补充能量，形成一个完美的能量闭环。

#### **核心技术架构**

1.  **“哨兵-指挥官”双处理器协同 (ULP & Main CPU):**
    *   系统的核心运行模式。**指挥官 (Main CPU)** 默认沉睡，**哨兵 (ULP)** 以纳瓦级功耗周期性巡逻，仅在必要时唤醒指挥官，从根本上杜绝了待机状态下的能源浪费。

2.  **鲁棒的启动与故障安全设计 (Robust Startup & Fault-Safe Design):**
    *   这是本设计的关键亮点。通过为所有P-MOSFET电源开关配备**~2kΩ的强上拉电阻**，我们确保了在MCU上电初始化的数百毫秒“空窗期”内，能够强制覆盖ESP32引脚约1.05V的默认弱低电平状态。这保证了所有受控外设（特别是12V升压模块）在上电瞬间**绝对处于关闭状态**，避免了意外启动和潜在的硬件冲突，实现了真正的**硬件级故障安全**。

3.  **全链路物理断电 (Total Power Gating):**
    *   系统中的每一个非核心元件（12V升压模块、墨水屏、湿度传感器），其电源VCC都由独立的P-MOSFET进行物理层面的开关控制，实现真正的零待机功耗。

4.  **模块化热插拔能源补给 (Modular Hot-Swappable Energy Replenishment):**
    *   太阳能充电系统被设计为一个**可选的、可热插拔的外部模块**。这使得HydroSense V2.1具备双重工作模式：在室内使用时，不连接太阳能板，它是一个纯粹的超低功耗设备；在户外部署时，接上太阳能模块，它则升级为一个能量自持系统。
    *   **安全集成：** 遵循**“单一保护入口”**原则，太阳能充电模块的输出端与HydroSense主板的用电输入端**并联**在TP4056保护板的`OUT+`和`OUT-`上。这确保了无论是USB充电、太阳能充电，还是系统放电，都处于同一个保护电路的监控之下，万无一失。

#### **系统精密运行周期详解**

系统的运行分为两个并行的、互不干扰的逻辑流：

**A) 浇水任务逻辑流 (由ESP32主动控制):**
这是一个从“深度沉睡”到“哨兵巡逻”，再到“指挥官行动”的事件驱动闭环。

*   **阶段一：深度沉睡 (Deep Sleep - 系统的基准态)**
    *   系统的常态。总静态功耗被稳定地控制在**10微安以内**。

*   **阶段二：“哨兵”的低功耗巡逻 (ULP's Low-Power Patrol)**
    *   由RTC定时器（例如，每30分钟）仅唤醒ULP协处理器。
    *   ULP执行精简程序：打开**3.3V**供电的湿度传感器电源 -> ADC读数 -> 关闭传感器电源 -> 内部比较湿度值。
    *   **决策：** 若湿度正常，ULP直接返回休眠；若湿度低于阈值，ULP唤醒主CPU“指挥官”。

*   **阶段三：“指挥官”的精准行动 (Main CPU's Precision Action)**
    *   主CPU醒来后，根据预设模式，执行完整的、安全的浇水序列（通告->启动动力->安全浇水->安全停止->关闭动力->最终报告），随后立即返回深度睡眠。

**B) 能量补充逻辑流 (被动、持续进行):**
这是一个独立于浇水任务的后台进程，只要太阳能模块被连接，它就会自动运行。

*   **条件：** 太阳能模块已插入，且太阳能板接收到有效光照（输入电压 > 6.5V）。
*   **过程：** CN3795模块自动启动，其MPPT功能开始实时追踪太阳能板的最大功率点，将转换后的电能，通过TP4056保护板，安全地为18650电池组充电。
*   **状态：** 充电过程中，模块上的充电指示灯会亮起。当电池充满（被TP4056的保护电路检测到），或光照消失，充电过程会自动停止。