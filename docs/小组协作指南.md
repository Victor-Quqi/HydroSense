### **HydroSense 项目小组协作指南**

本文档旨在指导开发流程，确保代码管理清晰高效。下面是推荐的使用 VS Code + PlatformIO + Git 的指南。如果想要用其它编辑器/IDE也可以自行配置。

#### **一、 环境准备 (只需一次)**

1.  **安装软件:**
    *   [Visual Studio Code](https://code.visualstudio.com/) (如果安装遇到问题或想要汉化可以自己在网上查找教程)
    *   [Git](https://git-scm.com/)
    *   在 VS Code 的扩展市场中搜索并安装 `PlatformIO IDE` 扩展（非必要）。

2.  **配置 Git 并获取项目代码 (Clone):**
    *   打开终端或 Git Bash，运行以下两条命令，替换成你自己的 GitHub 用户名和邮箱：
        ```bash
        git config --global user.name "你的GitHub用户名"
        git config --global user.email "你的GitHub邮箱"
        ```
    *   在你的电脑上找一个合适的位置（将作为在本地存放代码的位置），打开终端或 Git Bash。
    *   在这个位置运行以下命令，URL 为我们项目的 GitHub 地址：
        ```bash
        git clone https://github.com/Victor-Quqi/HydroSense.git
        ```
    *   这里可能需要打开网页登录 Github 验证身份。之后会在当前目录下创建一个 `HydroSense` 文件夹，里面包含了所有项目文件。

3.  **在 VS Code 中打开项目:**
    *   启动 VS Code。
    *   选择 `文件 (File)` > `打开文件夹 (Open Folder...)`。
    *   **务必选择**刚刚克隆下来的整个 `HydroSense` 文件夹，而不是里面的某个文件。
    *   PlatformIO 扩展会自动检测项目中的 `platformio.ini` 文件，并为你安装所有必需的依赖库和工具链（如 ESP32 框架）。你可以在底部状态栏看到它的工作进度。

#### **二、 核心开发流程 (每次开发都遵循)**

采用 `main` + `develop` 的分支模型：
*   `main` 分支：永远存放最稳定、可发布的代码。**一般情况下不应直接向 main 分支提交代码。**
*   `develop` 分支：我们日常开发、合并新功能的分支。**所有的工作都在这里进行。**

**你的工作循环如下：**

1.  **第一步：同步远程更新 (Sync)**
    *   **在开始写任何代码之前**，必须先拉取服务器上可能存在的最新代码。
    *   **操作:** 点击 VS Code 左下角状态栏的**同步更改**按钮。这能确保你的本地代码库是最新版本，避免冲突。

2.  **第二步：切换到开发分支 (Checkout)**
    *   **操作:** 点击 VS Code 左下角状态栏的**分支名称** (默认可能是 `main`)，在弹出的列表中选择 `develop`。确保你总是在 `develop` 分支上工作。

3.  **第三步：编写与修改代码**
    *   在 `src/` 目录下进行你的编码工作。
    *   PlatformIO 提供了编译、上传、监视串口等功能，你可以通过底部状态栏的快捷图标（对勾✔是编译，箭头→是上传）来使用它们。不过，原型在我手上，你们可能无法直接将固件上传到设备。

4.  **第四步：提交并推送你的贡献 (Commit & Push)**
    *   当你完成了一个小功能或修复了一个 Bug 后，就需要将你的代码贡献回小组仓库。
    *   **操作流程:**
        a.  点击左侧活动栏的**源代码管理**图标 (分叉树枝状)。
        b.  在“更改(Changes)”列表中，点击文件旁的 `+` 号，将你的修改**暂存(Stage)**起来。
        c.  在顶部的**消息(Message)**框中，填写本次提交的说明。**请遵循以下规范：**
            *   `feat: 添加了电池电压检测功能` (新增功能)
            *   `fix: 修复了土壤湿度传感器读数不准的问题` (修复 Bug)
            *   `docs: 更新了引脚规划说明文档` (只改了文档)
        d.  点击“提交”按钮旁边的**下拉箭头**，选择 **`提交和同步 (Commit & Sync)`**。这是最安全的操作，它会先拉取再推送，自动帮你处理潜在的冲突。

#### **三、 任务与看板 (Issues & Projects)**

在开始编码前，请先到 GitHub 的 `Issues` 和 `Projects` 区域明确你的任务。

*   **认领任务**: 你可以从 `Issues` 列表或 `开发看板` 的 `待办` 列中选择一个任务，将它**指派(Assign)**给你自己。
*   **创建任务**: 如果没有合适的任务，也可以根据总的`项目开发路线图` Issue，自己创建一个新的具体任务，然后指派给自己。

**最重要的一步**：将你负责的 Issue 卡片，在`开发看板`上从 `待办 (To Do)` **拖动**到 `进行中 (In Progress)`。这相当于公开宣布：“**我现在正在做这件事**”，可以有效避免重复工作。

#### **四、 重要原则**

1.  **先同步，再开发**：工作开始前先同步云端的更改。
2.  **在 `develop` 分支工作**：确认你的当前分支是 `develop`，而不是 `main`。
3.  **小步快跑，频繁提交**：不要憋着写几百行代码再提交一次。完成一个独立的小功能就提交一次，这样提交历史更清晰，也更容易回溯问题。
4.  **沟通**：在修改公共代码或不确定的地方时，先在群里打个招呼。

---

#### **五、 快速参考：VS Code 操作**

| 想做什么？ | 应该怎么做？ |
| :--- | :--- |
| **开始工作** | 点击左下角的 **同步更改** 按钮。 |
| **提交我修改/添加的代码** | 1. 去 **源代码管理** 视图（即左侧边栏上的分叉树枝状）。<br>2. 暂存 (`+`) 更改。<br>3. 写好消息。<br>4. 使用 **提交和同步 (Commit & Sync)**。 |
| **切换工作分支** | 点击左下角的 **分支名称**，在弹出菜单中选择。 |
| **编译/上传代码（可能用不到上传）** | 使用 VS Code 底部状态栏 PlatformIO 的快捷图标 (✔ / →)。 |